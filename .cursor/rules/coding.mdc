---
alwaysApply: true
---

## Package Management
- Always use pnpm instead of npm for package management
- Use `pnpm install` instead of `npm install`
- Use `pnpm add [package]` instead of `npm install [package]`
- Use `pnpm run [script]` instead of `npm run [script]`
- Use `pnpm audit` instead of `npm audit`
- Use `pnpm remove [package]` instead of `npm uninstall [package]`
- Use `pnpm update` instead of `npm update`

## Incremental Development Workflow

**CRITICAL: Work in small, manageable steps with review points**

- **Break tasks into small increments**: Never code large chunks without stopping points
- **One logical unit at a time**: Complete one function, component, or feature before moving to the next
- **Stop and review**: After each logical unit of work, pause and summarize what was done
- **Wait for assessment**: Do not continue to the next step until the user has reviewed and approved
- **Natural stopping points**: Stop after:
  - Completing a single function or utility
  - Creating a single component
  - Implementing a single API route
  - Making a single database schema change
  - Completing a single feature or sub-feature
- **Ask before proceeding**: If unsure whether to continue, ask the user if they want to review first
- **Summarize progress**: After each step, briefly summarize what was completed and what's next
- **Avoid scope creep**: Stay focused on the current task; don't add "while we're at it" features

**Example workflow:**
1. User requests: "Add user authentication"
2. AI breaks it down: "I'll start with the login page component first"
3. AI implements: Creates login page component
4. AI stops: "Login page component created. Ready for review before proceeding to API route."
5. User reviews and approves
6. AI continues: "Now I'll create the authentication API route..."

## SQL Scripts (Supabase / Migrations)
- **Always fully explain the script** before or when delivering it: what it does, which objects it changes, and why (e.g. "adds column X so that …", "drops function Y because return type changed").
- **Do NOT run the script without permission.** Never execute migrations or ad-hoc SQL (e.g. `supabase db push`, `psql`, or pasting into SQL Editor) unless the user explicitly asks to run it. Deliver the script and explanation; the user runs it (or explicitly approves running it).
- **Running migrations:** If the user approves, Cursor may run `supabase db push` (or `supabase db reset` / `supabase migration up` for local) in the terminal. Prefer migration-based workflow over one-off SQL execution.

## Terminal Usage
- **Cursor can use the terminal** to run commands when needed
- **Dev server:** Start or restart the dev server (e.g. `pnpm run dev`) when the user asks or when testing requires it
- **Git:** Run git commands (status, diff, commit, push, pull, etc.) when the user asks or as part of session workflow (e.g. commit and push at session end)
- Prefer the terminal for server, git, and build/script execution instead of assuming the server is already running or avoiding git

## Developer Feedback (Learning Mode)

When the developer is in learning mode or asks for explanation, provide feedback that helps them learn:

- **Assume general programming experience** but not necessarily deep expertise in JavaScript, Next.js, or the current stack. Explain in plain language; avoid jargon unless you define it.
- **Expand acronyms on first use** (e.g. "RPC (Remote Procedure Call)", "RLS (Row Level Security)").
- **Explain the "why" briefly** (1–2 sentences) when making changes or recommendations—what problem it solves or why the approach was chosen.
- **Point out common pitfalls** and how to avoid them when relevant (e.g. "PostgREST caches schema; that's why we use RPC for reads").
- **Use scannable format** when explaining: short sections, bullet points, or numbered steps. Use backticks for commands, file paths, and code identifiers.
- **Summarize at stopping points**: what was done, what it means, and what the next step is. This reinforces learning and keeps context clear.
- **Offer clarity before big changes**: if a task touches architecture or many files, briefly state what we're doing and how it fits the plan (e.g. "This is a fix for the current site, not CRM work").

## Additional Rules
- The dev server runs on port 3000 when started (`pnpm run dev`)
- Use available MCP servers for knowledgebase and understanding
- Place components in the root `/components` directory and combine by usecase in subdirectories
- Always use `/components/ui` for shadcn/ui base components when building new UI components
- Fetch logs from the console
- Suggest performance improvements
- Point out potential security issues and suggest solutions
- **At session wrap-up:** Verify no database tables were left in a vulnerable state (e.g. RLS disabled for testing). See Supabase rules — re-enable RLS or add a migration before ending the session.
- Don't install packages unless asked
- Prefer iteration and modularization over code duplication


## Debug Code Guidelines
- **Always comment out debug code** for easy cleanup later
- Use clear comment markers: `// DEBUG:` or `/* DEBUG: ... */`
- Wrap debug code blocks with start/end markers: `// DEBUG START` and `// DEBUG END`
- Example:
  ```typescript
  // DEBUG: Logging user data for troubleshooting
  // console.log("User data:", user);
  // DEBUG END
  ```
- This makes it easy to find and remove debug code before committing

## Git Submodule Management (Optional)
- **If using submodules:** Always refresh shared documentation submodules at the beginning of each coding session
- **Command:** Run `git submodule update --remote` to pull latest shared content
- **Purpose:** Ensure access to latest global PRD, technical specs, and shared documentation
- **Location:** `docs/shared/` typically contains read-only references to external repositories
- **Never modify:** Files in submodule directories are read-only - changes must be made in the source repository

## Context7 MCP Server Usage
- **Always use Context7 MCP server** for enhanced knowledge and context
- **Before coding:** Query Context7 for relevant documentation and best practices
- **For libraries/frameworks:** Use `mcp_context7_resolve-library-id` to find official docs
- **For documentation:** Use `mcp_context7_get-library-docs` to fetch up-to-date docs
- **Search strategy:** Query Context7 when working with:
  - Next.js, React, TypeScript, Tailwind CSS, shadcn/ui
  - Supabase, Drizzle ORM, Express.js
  - Authentication, security, database design
  - Multi-component architecture patterns
  - Deployment and CI/CD best practices
- **Integration approach:** Use Context7 insights to inform coding decisions and suggest modern patterns
- **Documentation priority:** Always check Context7 before implementing new features or solving complex problems